Test_Square:
  runs-on: ubuntu-latest
  needs: Compilation
  steps:
    - name: Checkout
      uses: actions/checkout@v4

    - name: Build
      run: |
        mkdir -p build
        cd build
        cmake ..
        make

    - name: Run test "car" (square) and capture report
      run: |
        cd build
        set -e
        echo "== Test car (square) 5 ==" > report.txt
        ./src/calculator car 5 | tee -a report.txt
        echo "Exit code: $?" >> report.txt

    - name: Upload report as artifact
      uses: actions/upload-artifact@v4
      with:
        name: test-car-report
        path: build/report.txt      # <-- The file to download as artifact
        retention-days: 14          # Optional, specify how long to retain the artifact

    - name: Job summary (optional but useful)
      run: |
        echo "### RÃ©sultat du test *car* (square)" >> $GITHUB_STEP_SUMMARY
        echo '' >> $GITHUB_STEP_SUMMARY
        echo '```' >> $GITHUB_STEP_SUMMARY
        cat build/report.txt >> $GITHUB_STEP_SUMMARY
        echo '```' >> $GITHUB_STEP_SUMMARY
